"use strict";var table,lineMapping,OHLCMapping,chart,line,domain="https://core.crmhub.info",dataType="candlestick",timeStep="15Ms",stringType="Ohlc?",stringSymbol="EURUSD",resultArr=[],tailPoint=[];function getDataArr(){ajax(domain+"/api/"+stringType+"timer="+timeStep+"&symbol="+stringSymbol,"get",dataArrHandler)}function dataArrHandler(t){var e=JSON.parse(t);if(resultArr=[],"areaspline"==dataType){for(var a=0;a<e.length;a++){var r=e[a].Date,l=+r.slice(0,4),i=r.slice(5,7)-1,n=+r.slice(8,10),s=+r.slice(11,13),o=+r.slice(14,16),c=[];c.push(Date.UTC(l,i,n,s,o)),c.push(e[a].Value),resultArr.push(c)}tailPoint=resultArr[resultArr.length-1],resultArr.push(tailPoint)}else if("candlestick"==dataType||"ohlc"==dataType){for(var d=0;d<e.length;d++){var h=e[d].DateClose,p=+h.slice(0,4),u=h.slice(5,7)-1,g=+h.slice(8,10),m=+h.slice(11,13),y=+h.slice(14,16),f=[];f.push(Date.UTC(p,u,g,m,y)),f.push(e[d].Open),f.push(e[d].Hight),f.push(e[d].Low),f.push(e[d].Close),resultArr.push(f)}tailPoint[0]=resultArr[resultArr.length-1][0],tailPoint[1]=resultArr[resultArr.length-1][1],tailPoint[2]=resultArr[resultArr.length-1][2],tailPoint[3]=resultArr[resultArr.length-1][3],tailPoint[4]=resultArr[resultArr.length-1][4],resultArr.push(tailPoint)}document.getElementById("graphic").innerHTML="",drawChart()}function drawChart(){var t=document.querySelector("#graphic");t.innerHTML="",(table=anychart.data.table()).addData(resultArr),(lineMapping=table.mapAs()).addField("value",1,"last"),(OHLCMapping=table.mapAs()).addField("open",1,"first"),OHLCMapping.addField("high",2,"max"),OHLCMapping.addField("low",3,"min"),OHLCMapping.addField("close",4,"last"),OHLCMapping.addField("value",4,"last"),chart=anychart.stock(),"areaspline"==dataType?(line=chart.plot(0).spline(lineMapping)).stroke("lightgrey",1):"candlestick"==dataType?((line=chart.plot(0).candlestick(OHLCMapping)).fallingFill("grey").fallingStroke("grey"),line.risingFill("white").risingStroke("white")):"ohlc"==dataType&&((line=chart.plot(0).ohlc(OHLCMapping)).fallingStroke("red"),line.risingStroke("grey")),chart.background().fill("transparent"),line.name(stringSymbol);var e=chart.plot().xAxis();e.labels({anchor:"left-top"}),e.minorLabels({anchor:"left-top"}),e.ticks({stroke:"#2f302d"}),e.minorTicks({stroke:"#2f302d"});var a=chart.plot().yAxis();a.stroke({color:"#2f302d"}),a.ticks({stroke:"#2f302d"}),a.minorTicks({stroke:"#2f302d"}),e.labels().format(function(){return anychart.format.dateTime(this.tickValue,"dd.MM.yy \n HH:mm")}),e.minorLabels().format(function(){return anychart.format.dateTime(this.tickValue,"dd.MM.yy \n HH:mm")}),e.ticks().position("inside"),e.minorTicks().position("inside"),e.height(36),chart.plot().yAxis().orientation("right"),chart.padding(0,80,10,10),chart.plot().xGrid().enabled(!0).stroke({color:"#2f302d"}),chart.plot().yGrid().enabled(!0).stroke({color:"#2f302d"}),chart.plot().xMinorGrid().enabled(!0).stroke({color:"#2f302d"}),chart.plot().yMinorGrid().enabled(!0).stroke({color:"#2f302d"}),chart.plot().crosshair().xStroke("red",1),chart.plot().crosshair().yStroke("red",1);var r=chart.plot().priceIndicator();r.value("last-visible"),r.stroke("#349cff",1,"8 3"),r.label().background().fill("#349cff"),r.label().fontColor("white"),chart.scroller().enabled(!1),chart.plot().legend(!0),chart.plot().legend().titleFormat("{%value}{dateTimeFormat: dd.MM.yyyy HH:mm}"),chart.crosshair().xLabel().format(function(){return anychart.format.dateTime(this.tickValue,"dd.MM.yy hh:mm")}),chart.crosshair().yLabel().format(function(){return this.value}),chart.container(t),chart.draw(),document.getElementsByClassName("anychart-credits")[0].remove(),t.insertAdjacentHTML("beforeEnd",'<div style=" background-color: #2f302d;                    width : calc(100% - 92px);                    height: 1px;                    position: absolute;                    bottom: 45px;                    left  : 12px">      </div>'),tugOfWarAnimation()}function wagTheTail(t){var e=+t.time.slice(0,4),a=t.time.slice(5,7)-1,r=+t.time.slice(8,10),l=+t.time.slice(11,13),i=+t.time.slice(14,16),n=Date.UTC(e,a,r,l,i),s=Math.round(1e5*t.value)/1e5;table.remove(resultArr[resultArr.length-1][0],resultArr[resultArr.length-1][0]),"areaspline"==dataType?table.addData([[n,s]]):"candlestick"!=dataType&&"ohlc"!=dataType||(tailPoint[0]=n,tailPoint[4]=s,(tailPoint[2]<s||!tailPoint[2])&&(tailPoint[2]=s),(tailPoint[3]>s||!tailPoint[3])&&(tailPoint[3]=s),table.addData([tailPoint]))}function addPoint(){ajax(domain+"/api/"+stringType+"timer="+timeStep+"&symbol="+stringSymbol,"get",redrawChart)}function redrawChart(t){var e=JSON.parse(t),a=e[e.length-1];if(table.remove(resultArr[resultArr.length-1][0],resultArr[resultArr.length-1][0]),"areaspline"==dataType){var r=+a.Date.slice(0,4),l=a.Date.slice(5,7)-1,i=+a.Date.slice(8,10),n=+a.Date.slice(11,13),s=+a.Date.slice(14,16),o=Date.UTC(r,l,i,n,s);table.addData([[o,a.Value]]),table.addData([[o+1e3,a.Value]])}else if("candlestick"==dataType||"ohlc"==dataType){var c=+a.DateClose.slice(0,4),d=a.DateClose.slice(5,7)-1,h=+a.DateClose.slice(8,10),p=+a.DateClose.slice(11,13),u=+a.DateClose.slice(14,16),g=Date.UTC(c,d,h,p,u);table.addData([[g,a.Open,a.Hight,a.Low,a.Close]]),table.addData([[g,a.Close,a.Close,a.Close,a.Close]])}}getDataArr();